{% extends "base.html" %}
{% load i18n static %}

{% block title %}{% trans "Nouveau mot de passe" %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/pages/login.css' %}">
{% endblock %}

{% block content %}
<div class="login-container">
    <div class="login-brand">
        <div class="brand-content">
            <div class="brand-logo">
                BENJAMIN<br>
                <span style="font-size: 0.6em; letter-spacing: 0.2em;">IMMOBILIER</span>
            </div>
            <div class="brand-subtitle">INTRANET</div>
        </div>
    </div>

    <div class="login-form-panel">
        <div class="login-form-wrapper">

            {% if validlink %}
            <div class="login-header">
                <h1>{% trans "Nouveau mot de passe" %}</h1>
                <p>{% trans "Choisissez un mot de passe sécurisé." %}</p>
            </div>

            <form method="post">
                {% csrf_token %}

                {% for field in form %}
                <div class="form-group">
                    <label class="form-label" for="{{ field.id_for_label }}">{{ field.label }}</label>
                    <div class="input-container">
                        {{ field }}
                        <i class="bi bi-lock input-icon"></i>
                    </div>
                    {% if field.help_text %}
                    <small class="text-secondary d-block mt-1">{{ field.help_text }}</small>
                    {% endif %}
                    {% if field.errors %}
                    <div class="text-danger small mt-1">{{ field.errors }}</div>
                    {% endif %}
                </div>
                {% endfor %}

                <button type="submit" class="btn-login">
                    {% trans "Changer le mot de passe" %} <i class="bi bi-arrow-right"></i>
                </button>

            </form>

            {% else %}
            <div class="login-header">
                <h1>{% trans "Lien invalide" %}</h1>
                <p class="text-danger">{% trans "Ce lien a expiré." %}</p>
            </div>

            <div style="text-align: center; margin-bottom: 2rem;">
                <i class="bi bi-x-circle" style="font-size: 3rem; color: var(--bs-danger);"></i>
                <p class="mt-3 text-secondary">
                    {% trans "Veuillez refaire une demande de réinitialisation." %}
                </p>
            </div>

            <a href="{% url 'authentication:password_reset' %}" class="btn-login"
                style="text-decoration: none; text-align: center; display: block;">
                {% trans "Nouvelle demande" %}
            </a>
            {% endif %}

            <div class="copyright">
                &copy; {% now "Y" %} Benjamin Immobilier
            </div>

        </div>
    </div>
</div>

<script>
    document.querySelectorAll(".login-form-wrapper input").forEach(el => {
        el.classList.add("form-control");
    });
</script>
{% endblock %}